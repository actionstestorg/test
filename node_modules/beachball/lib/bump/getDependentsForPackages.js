"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDependentsForPackages = void 0;
const PackageInfo_1 = require("../types/PackageInfo");
/**
 * Gets dependents for all packages (child points to parents): if A depends on B, then `{B: [A]}`
 *
 * Example: "BigApp" deps on "SomeUtil", "BigApp" would be the dependent.
 * => `{ "SomeUtil": ["BigApp"] }`
 */
function getDependentsForPackages(bumpInfo) {
    const { packageInfos, scopedPackages } = bumpInfo;
    const dependents = {};
    for (const [pkgName, info] of Object.entries(packageInfos)) {
        if (!scopedPackages.has(pkgName)) {
            continue;
        }
        for (const depType of PackageInfo_1.consideredDependencies) {
            for (const dep of Object.keys(info[depType] || {})) {
                if (packageInfos[dep]) {
                    dependents[dep] ?? (dependents[dep] = []);
                    if (!dependents[dep].includes(pkgName)) {
                        dependents[dep].push(pkgName);
                    }
                }
            }
        }
    }
    return dependents;
}
exports.getDependentsForPackages = getDependentsForPackages;
//# sourceMappingURL=getDependentsForPackages.js.map