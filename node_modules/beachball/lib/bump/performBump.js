"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.performBump = void 0;
const unlinkChangeFiles_1 = require("../changefile/unlinkChangeFiles");
const writeChangelog_1 = require("../changelog/writeChangelog");
const callHook_1 = require("./callHook");
const updatePackageJsons_1 = require("./updatePackageJsons");
const updateLockFile_1 = require("./updateLockFile");
/**
 * Performs the bump and writes to the filesystem:
 * update package.json files, update lock file, write changelogs, and delete change files.
 */
async function performBump(bumpInfo, options) {
    const { modifiedPackages, packageInfos, changeFileChangeInfos } = bumpInfo;
    await (0, callHook_1.callHook)(options.hooks?.prebump, modifiedPackages, packageInfos);
    (0, updatePackageJsons_1.updatePackageJsons)(modifiedPackages, packageInfos);
    await (0, updateLockFile_1.updateLockFile)(options.path);
    if (options.generateChangelog) {
        // Generate changelog
        await (0, writeChangelog_1.writeChangelog)(bumpInfo, options);
    }
    if (!options.keepChangeFiles) {
        // Unlink changelogs
        (0, unlinkChangeFiles_1.unlinkChangeFiles)(changeFileChangeInfos, packageInfos, options);
    }
    await (0, callHook_1.callHook)(options.hooks?.postbump, modifiedPackages, packageInfos);
    // This is returned from bump() for testing
    return bumpInfo;
}
exports.performBump = performBump;
//# sourceMappingURL=performBump.js.map