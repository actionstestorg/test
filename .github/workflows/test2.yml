name: upgrade package versions

on:
  workflow_dispatch:

jobs:
  upgrade-package-versions:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout iTwin/studio repository
        uses: actions/checkout@v2
        with:
          repository: iTwin/studio
          token: ${{ secrets.PAT_STUDIO_REPO_ACCESS }}

      - name: Checkout iTwin/drawing-production repository
        uses: actions/checkout@v2
        with:
          path: drawing-production
          repository: iTwin/drawing-production
          ref: dev
          token: ${{ secrets.PAT_DRAWING_PRODUCTION_REPO_ACCESS }}
      
      - name: install pnpm version 8.15.7
        run: |
          npm install -g pnpm@8.15.7

      - name: Install iTwinStudioForDevelopers
        run: |
            curl -O https://qa-autoupdatecdn.bentley.com/itwindesktopplatform/developer/iTwinStudioforDevelopers.deb
            sudo apt install ./iTwinStudioforDevelopers.deb
      
      - name: upgrade packages
        run: |
          cd drawing-production
          node ./scripts/updatePackageVersions.js

      - name: install packages
        run: |
          cd drawing-production
          pnpm install

      - name: clean and build
        run: |
          ls
          cd drawing-production
          pnpm run clean-build

          
